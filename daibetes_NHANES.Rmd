---
output:
  html_notebook: default
  pdf_document: default
  word_document: default
---
# WHAT IS NHANES?

The NHANES survey is conducted by the US CDC. [More about NHANES](https://www.cdc.gov/nchs/nhanes/about/index.html). These surveys have been conducted since the 1960â€™s.

Starting in 1999, about 5,000 individuals of all ages have been interviewed every year and then they complete the health examination component of the survey. Part of this dataset is made available via the NHANES package which can be loaded this way:

```{r}
data(NHANES) 
dim(NHANES)

```
Before we start, it is necessary run the packages that we are going to use, in this case would be: 

```{r setup}
library(tidyverse)
library(gtsummary)
library(NHANES)
library(ggplot2)
library(scales)
```


## **Is sleep trouble associated with Type II diabetes, after adjusting other factors?**

It has been shown that there is a relationship between type II diabetes and sleep problems, several studies suggest that sleep problems are associated with an increased risk of developing type II diabetes. Sleep trouble may alter metabolic, endocrine, and inflammatory pathways, thereby increasing diabetes risk (Cappuccio et al., 2010; Darraj, 2023).

Furthermore, factors such as depression, higher body mass index (BMI), older age, lower socioeconomic status, education, and some racial and ethnic background have all been linked to higher rates of diabetes (Knol et al., 2006; Hill-Briggs et al., 2021; Spanakis & Golden, 2013). 

### Hypothesis

People with sleep trouble are more likely to have diabetes type II, even after adjusting for other risk factors

### Preparing the data

Select only the data that we will use.

```{r}
NHANES %>% select(Diabetes, SleepTrouble, Age, BMI, PhysActive, Education, Race1, Depressed, Poverty)
Sleep_data <-NHANES %>% select(Diabetes, SleepTrouble, Age, BMI, PhysActive, Education, Race1, Depressed, Poverty) %>% filter(!is.na(Diabetes),!is.na(SleepTrouble), !is.na(Age), !is.na(Education), !is.na(Race1),  !is.na(Depressed), !is.na(Poverty))
summary(Sleep_data)

```

### Graphics models

To have an overview of the relationship between diabetes and other factors, a graphic model of each of them was created.

```{r Graphics}
Sleep_data %>%  ggplot(aes(x=SleepTrouble, fill= Diabetes )) + geom_bar(position="fill") + scale_y_continuous(labels = scales::percent) + labs(y = "Proportion", title = "Prevalence of Type II Diabetes by Sleep Trouble")


Sleep_data %>%  
  ggplot(aes(x=Age, fill= Diabetes )) + 
  geom_boxplot() + 
  labs(
    title = "Percentage of Diabetes II patients by Age") +
  theme_minimal()


Sleep_data %>%  
  ggplot(aes(x=BMI, fill= Diabetes )) + 
  geom_boxplot()+ 
  labs( 
    title = "Percentage of Diabetes II patients by BMI") +
  theme_minimal()


Sleep_data %>%  
  ggplot(aes(x=PhysActive, fill= Diabetes)) + 
  geom_bar() + 
  labs(
    y = "Proportion", 
    title = "Prevalence of Type II Diabetes by Physical Activity") +
  theme_minimal()


Sleep_data %>% 
  ggplot(aes(x = Education, fill = Diabetes)) + 
  geom_bar(position = "fill") + 
  scale_y_continuous(labels = scales::percent) + 
  labs(
    y = "Proportion", 
    title = "Percentage of Diabetes II patients by Education Level")+
  theme_minimal()


Sleep_data %>% 
  ggplot(aes(x = Race1, fill = Diabetes)) + 
  geom_bar(position = "fill") + 
  scale_y_continuous(labels = scales::percent) + 
  labs(
    y = "Proportion", 
    title = "Percentage of Diabetes II patients by Race") +
  theme_minimal()


Sleep_data %>%  ggplot(aes(x=Depressed, fill= Diabetes)) + 
  geom_bar(position="fill") + 
  scale_y_continuous(labels = scales::percent) + 
  labs(y = "Proportion", 
       title = "Prevalence of Type II Diabetes by Depression Status")+
  theme_minimal()


Sleep_data %>%  ggplot(aes(x=Poverty, fill= Diabetes)) + 
  geom_boxplot()  + 
  labs(
    y = "Proportion", 
    title = " Prevalence of Type II Diabetes by Income Level") +
  theme_minimal()
```

## Run logistical regression model


```{r}
Sleep_data_glm<-glm(Diabetes ~ SleepTrouble + Age + BMI+ PhysActive + Education + Race1 + Depressed + Poverty, data= Sleep_data, family = binomial(link = "logit"))
summary(Sleep_data_glm)


```
```{r}
odds_ratios <- exp(coef(Sleep_data_glm))
print(odds_ratios)
```
```{r}
percent_change <- (odds_ratios - 1) * 100
print(round(percent_change, 2))
```

```{r}
Sleep_data <- Sleep_data %>%
  mutate(predicted = predict(Sleep_data_glm, newdata = Sleep_data, type = "response"))

```

```{r}
Sleep_data %>% group_by(SleepTrouble) %>%
  summarise(prob = mean(predicted, na.rm = TRUE)) %>%
  ggplot(aes(x = SleepTrouble, y = prob)) + geom_col(fill = "cornflowerblue") + labs(y = "Predicted Probability", title = "Estimated Probability of Type II Diabetes by Sleep Trouble") + theme_minimal()
```



**Interpretation:**





